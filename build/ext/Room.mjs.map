{
  "version": 3,
  "sources": ["../../src-backend/ext/Room.ts"],
  "sourcesContent": ["//\r\n// Monkey-patch Colyseus' default behaviour\r\n//\r\nimport { Room, Client, ClientPrivate } from \"@bizsim-game-studios/colyseus-core\";\r\n\r\nfunction getStateSize(room) {\r\n    // TODO: `Serializer<T>` should provide a method for this (e.g. `serializer.hasState()`)\r\n    const hasState = (\r\n      room._serializer.encoder || // schema v3\r\n      room._serializer.state || // schema v2\r\n      room._serializer.previousState // legacy-fossil-delta\r\n    );\r\n    const fullState = hasState && room._serializer.getFullState();\r\n    return fullState && (fullState.byteLength || fullState.length) || 0;\r\n}\r\n\r\n(<any>Room.prototype).getAvailableData = function () {\r\n    return {\r\n        clients: this.clients.length,\r\n        maxClients: this.maxClients,\r\n        metadata: this.metadata,\r\n        roomId: this.roomId,\r\n    };\r\n};\r\n\r\n(<any>Room.prototype).getRoomListData = async function () {\r\n    const stateSize = getStateSize(this);\r\n    const elapsedTime = this.clock.elapsedTime;\r\n    const locked = this.locked;\r\n    const data = this.getAvailableData();\r\n\r\n    return { ...data, locked, elapsedTime, stateSize };\r\n};\r\n\r\n(<any>Room.prototype).getInspectData = async function () {\r\n    const state = this.state;\r\n    const stateSize = getStateSize(this);\r\n    const roomElapsedTime = this.clock.elapsedTime;\r\n\r\n    const data = this.getAvailableData();\r\n    const clients = this.clients.map((client: Client & ClientPrivate) => ({\r\n        sessionId: client.sessionId,\r\n        elapsedTime: roomElapsedTime - client._joinedAt\r\n    }));\r\n    const locked = this.locked;\r\n\r\n    return { ...data, locked, clients, state, stateSize };\r\n};\r\n\r\n// Actions\r\n(<any>Room.prototype)._forceClientDisconnect = async function (sessionId) {\r\n    for (let i = 0; i < this.clients.length; i++) {\r\n        if (this.clients[i].sessionId === sessionId) {\r\n            this.clients[i].leave();\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\n(<any>Room.prototype)._sendMessageToClient = async function (sessionId, type, data) {\r\n    for (let i = 0; i < this.clients.length; i++) {\r\n        if (this.clients[i].sessionId === sessionId) {\r\n            this.clients[i].send(type, data);\r\n            break;\r\n        }\r\n    }\r\n};\r\n"],
  "mappings": ";AAGA,SAAS,YAAmC;AAE5C,SAAS,aAAa,MAAM;AAExB,QAAM,WACJ,KAAK,YAAY;AAAA,EACjB,KAAK,YAAY;AAAA,EACjB,KAAK,YAAY;AAEnB,QAAM,YAAY,YAAY,KAAK,YAAY,aAAa;AAC5D,SAAO,cAAc,UAAU,cAAc,UAAU,WAAW;AACtE;AAEM,KAAK,UAAW,mBAAmB,WAAY;AACjD,SAAO;AAAA,IACH,SAAS,KAAK,QAAQ;AAAA,IACtB,YAAY,KAAK;AAAA,IACjB,UAAU,KAAK;AAAA,IACf,QAAQ,KAAK;AAAA,EACjB;AACJ;AAEM,KAAK,UAAW,kBAAkB,iBAAkB;AACtD,QAAM,YAAY,aAAa,IAAI;AACnC,QAAM,cAAc,KAAK,MAAM;AAC/B,QAAM,SAAS,KAAK;AACpB,QAAM,OAAO,KAAK,iBAAiB;AAEnC,SAAO,EAAE,GAAG,MAAM,QAAQ,aAAa,UAAU;AACrD;AAEM,KAAK,UAAW,iBAAiB,iBAAkB;AACrD,QAAM,QAAQ,KAAK;AACnB,QAAM,YAAY,aAAa,IAAI;AACnC,QAAM,kBAAkB,KAAK,MAAM;AAEnC,QAAM,OAAO,KAAK,iBAAiB;AACnC,QAAM,UAAU,KAAK,QAAQ,IAAI,CAAC,YAAoC;AAAA,IAClE,WAAW,OAAO;AAAA,IAClB,aAAa,kBAAkB,OAAO;AAAA,EAC1C,EAAE;AACF,QAAM,SAAS,KAAK;AAEpB,SAAO,EAAE,GAAG,MAAM,QAAQ,SAAS,OAAO,UAAU;AACxD;AAGM,KAAK,UAAW,yBAAyB,eAAgB,WAAW;AACtE,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,QAAQ,KAAK;AAC1C,QAAI,KAAK,QAAQ,CAAC,EAAE,cAAc,WAAW;AACzC,WAAK,QAAQ,CAAC,EAAE,MAAM;AACtB;AAAA,IACJ;AAAA,EACJ;AACJ;AAEM,KAAK,UAAW,uBAAuB,eAAgB,WAAW,MAAM,MAAM;AAChF,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,QAAQ,KAAK;AAC1C,QAAI,KAAK,QAAQ,CAAC,EAAE,cAAc,WAAW;AACzC,WAAK,QAAQ,CAAC,EAAE,KAAK,MAAM,IAAI;AAC/B;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": []
}
